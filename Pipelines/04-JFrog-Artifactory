node {
   // some block because pipeline needs to mention the current node

def server = Artifactory.server "01"
def buildInfo = Artifactory.newBuildInfo()

//Project Path
def project_path ="03-App-Code/petclinic-code/"



stage('Git CheckOut'){
    git branch: 'master', url: 'https://github.com/Kunal2097/devops-mindtree-25-Nov-2021.git'
}
//sh 'pwd'
//sh 'cd /home/kunal/Desktop/DEV-OPS/JENKINS/devops-mindtree-25-Nov-2021/03-App-Code/petclinic-code'
//sh 'pwd'

dir(project_path) {
    // some block
        stage('Maven clean') {
        // some block
        sh 'mvn clean'
    }
    
    stage('Maven compile') {
        // some block
        sh 'mvn compile'
    }
    
    stage('Maven test') {
        // some block
        sh 'mvn test'
    }
    
    stage('Maven package') {
        // some block
        sh 'mvn package'
    }
  
    stage ('Build Management'){
	def uploadSpec ="""{
		 "files":[
		{
		"pattern": "**/*.war",
		"target": "petclinic-repo"
		}	
		]
	   }"""
	   server.upload spec: uploadSpec
	}


    stage('Publish Build Info'){
		server.publishBuildInfo buildInfo
	}

    stage('Archive Artifact'){
        archiveArtifacts artifacts: 'target/petclinic.war', followSymlinks: false
    }
      // stage('Docker Deployment'){
     //  sh 'docker-compose up -d --build'
   // }

}

//node ends
}

